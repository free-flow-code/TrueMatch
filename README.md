# TrueMatch

Сервис знакомств на FastApi. Состоит из 3х эндпоинтов:

- Эндпоинт для регистрации нового участника:
  - URL: /api/clients/create
  
  При регистрации нового участника на его аватарку накладывается водяной знак.
  Наложение выполняется через брокер задач, не блокируя основной поток выполнения.
- Эндпоинт оценивания участником другого участника:
  - URL: /api/clients/{id}/match

  Если у пользователей возникает взаимная симпатия, то обоим высылается почта другого участника 
  на email с сообщением вида: «Вы понравились <имя>! Почта участника: <почта>». 
- Эндпоинт для получения списка участников:
  - URL: /api/list
  
  Доступна фильтрация по полу, имени, фамилии и дате регистрации.

## Подготовка к установке

Python 3.9 должен быть установлен.Создайте виртуальное окружение и установите зависимости командой:

```pip install -r requirements.txt```

Создайте базы данных PostgreSQL 16 и Redis. В корне проекта создайте
'.env' файл с переменными окружения:

```
DAILY_LIKES_LIMIT=10
AVATARS_DIR="app/static/avatars/"
WATERMARK_PATH="app/static/watermark.png"
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASS=root
DB_NAME=postgres
ENCRYPTION_KEY=s3XUjyntOk0o=
JWT_SECRET_KEY=asdlajsdasASDASD=
ALGORITHM=HS256
ORIGINS=["http://127.0.0.1:8000", "http://127.0.0.1:3000"]
REDIS_HOST=localhost
REDIS_PORT=6379
SMTP_HOST=smtp.mail.com
SMTP_USER=mymail@mail.com
SMTP_PASSWORD=password
SMTP_PORT=465
```
где:

- `DAILY_LIKES_LIMIT` лимит лайков в сутки, по умолчанию 10
- `AVATARS_DIR` путь к директории с аватарами пользователей, по умолчанию **app/static/avatars/**
- `WATERMARK_PATH` путь к изображению водяного знака, по умолчанию **app/static/watermark.png**
- `DB_HOST` адрес БД, по умолчанию 'localhost'
- `DB_PORT` порт БД, по умолчанию '5432'
- `DB_USER` пользователь БД, по умолчанию 'postgres'
- `DB_PASS` пароль БД, по умолчанию 'root'
- `DB_NAME` название БД, по умолчанию 'postgres'
- `ENCRYPTION_KEY` ключ для шифрования паролей пользователей, нет значения по умолчанию
- `JWT_SECRET_KEY` ключ для генерации JWT-токена, нет значения по умолчанию
- `ALGORITHM` алгоритм для шифрования JWT-токена, по умолчанию 'HS256'
- `JWT_TOKEN_DELAY_MINUTES` время жизни JWT-токена в минутах, по умолчанию 30
- `ORIGINS` список разрешенных адресов для работы с API, по умолчанию '["http://127.0.0.1:8000", "http://127.0.0.1:3000"]'
- `REDIS_HOST` адрес redis, по умолчанию 'localhost'
- `REDIS_PORT` порт redis, по умолчанию '6379'
- `SMTP_HOST` хост почтового сервера, нет значения по умолчанию
- `SMTP_USER` адрес почты, для подключения к серверу, нет значения по умолчанию
- `SMTP_PASSWORD` пароль, для подключения к почтовому серверу, нет значения по умолчанию
- `SMTP_PORT` порт почтового сервера, нет значения по умолчанию

Примените миграции командой:
```sh
$ alembic upgrade head
```

## Redis

Включите аутентификацию на серверах Redis, чтобы требовать аутентификацию перед выполнением любых операций.
Используйте сильные пароли или механизмы аутентификации, предоставляемые Redis.

Включение аутентификации в Redis:

```
#В файле redis.conf установите пароль
requirepass your_password
```
Настройка сетевого доступа: Ограничьте доступ к серверам Redis только для доверенных IP-адресов или подсетей.
Это можно сделать через настройки брандмауэра или конфигурации самого кэш-сервера.

Настройка сетевого доступа в Redis:

```
#В файле redis.conf установите разрешенные IP-адреса
bind 127.0.0.1
```